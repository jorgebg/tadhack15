
<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.4.2.min.js"></script>
    <script src="http://s.phono.com/releases/1.1/jquery.phono.js"></script>
  </head>
  <body>

    <div id="sip"></div>
    <div id="status">Initializing...</div>
    <input id="btnanswer" type="button" value="Answer" disabled />
    <input id="btnhangup" type="button" value="Hangup" disabled />
    <script>

	document.addEventListener('DOMContentLoaded', function () {
	  if (Notification.permission !== "granted")
	    Notification.requestPermission();
	});

        var mysip = ""

	$.phono({
	  apiKey: "",
	  audio: {type:"flash"},
	  onReady: function(event) {
	  	mysip = this.sessionId;
                $('#sip').text("sip:"+this.sessionId);
	  	$('#status').text("Wait for call");
                var url = "/register?sip="+encodeURIComponent(this.sessionId)
                $.get( "/register?sip="+url, function( data ) {
                   $('#status').text("Registered! "+data);
                });                
	  },
	  phone: {
	    onIncomingCall: function(event) {
	      var call = event.call;
	  	  $('#status').text("incoming call!");
	      $('#btnanswer').removeAttr('disabled'); 	 
	      $('#btnhangup').removeAttr('disabled'); 	 

	    var notification = new Notification('Notification title', {
	      icon: 'https://cdn0.iconfinder.com/data/icons/basic-ui-elements-round/700/08_phone-512.png',
	      body: "Incomming call! "+call.id+"->"+mysip,
	    });

	    notification.onclick = function () {
 			$('#btnanswer').attr("disabled", true);
 		    call.answer();
	    };

		  $( "#btnanswer" ).click(function() {
 			$('#btnanswer').attr("disabled", true);
 		    call.answer();
		  });

		  $( "#btnhangup" ).click(function() {
		    call.hangup();
	 			$('#btnanswer').attr("disabled", true);
	 			$('#btnhangup').attr("disabled", true);
			  	$('#status').text("Wait for call");
		  });

	      call.bind({
	          onHangup: function(event) {
	 			$('#btnanswer').attr("disabled", true);
	 			$('#btnhangup').attr("disabled", true);
			  	$('#status').text("Wait for call");
	               console.log("Call hung up");
	          }});
	    }
	  }
	});



    </script>

  </body>
</html>
